%-------------------------------------------------------------------------------
\section{Systematic uncertainties}
\label{sec:systematics}
%-------------------------------------------------------------------------------
The signal efficiency and the background estimations are affected by uncertainties associated with the detector simulation, the signal modelling and the data-driven background determination. In the combined fit, these uncertainties recommended by the various ATLAS working groups are called Nuisance Parameters (NP), as opposed to the parameter of interest, the signal strength, which is a scaling factor applied on the total signal events.

Any systematic effect on the the overall normalisation or shape of the final BDT distribution in the signal region is considered. In \texttt{TRExFitter} \cite{TRExFitter}, the NP pruning is applied, which means that NPs whose impact are less than a certain threshold are discarded. The lower thresholds to remove a shape systematic and a normalisation systematic from the fit are both $1\%$ in the fit.

%\input{\FCNCTables/NPlist}
%Ztautau theory Xsec
%top theory Xsec

\subsection{Luminosity}
\label{sec:systematic_Luminosity}
The integrated luminosity measurement has an uncertainty of $1.7\%$ for the combined Run-2 data, and it is applied to all simulated event samples including both signal and background.

\subsection{Detector-related uncertainties}
\label{sec:syst_det}

Uncertainties related to the detector are included for the signal and backgrounds that are estimated using simulation. These uncertainties are also taken into account for the simulated events that enter the data-driven background estimations. All instrumental systematic uncertainties arising from the reconstruction, identification and energy scale of electrons, muons, ($b$-)jets and the soft term of the $\met$ measurement are considered. The effect of the energy scale uncertainties on the objects is propagated to the $\met$ calculation. These systematics include uncertainty associated with:

\begin{itemize}
\item The electron and muon trigger, reconstruction, identification and isolation efficiencies. These are estimated with the tag-and-probe method on the $Z\to ll$, $J/\psi\to ll$ and $W\to l\nu$ events \cite{lep_sys}.
\item Electron and muon momentum scales. They are estimated from the early 13 TeV $Z\to ll$ events.
\item Jet energy scale (JES) and resolution (JER). The JES uncertainty is estimated by varying the jet energies according to the uncertainties derived from simulation and in-situ calibration measurements using a model with a reduced set of 39 orthogonal NPs \cite{jet_sys} which has up to 30\% correlation losses, which are assumed to be uncorrelated, and the induced changes can be added in quadrature. The individual scale variations on the jets are parameterised in $\pt$ and $\eta$. The total JES uncertianty is below 5\% for most jets and below 1\% for central jets with pT between 300 GeV and 2 TeV.
The difference between the JER in data and MC is represented by one NP. It is applied on the MC by smearing the jet $\pt$ within the prescribed uncertainty.
JVT is applied in the analysis to select jets from hard-scattered vertices. It was found that different MC generators (and different fragmentation models) lead to efficiency differences of up to $1\%$, and the uncertainty on the efficiency measurement was found to be around $0.5\%$. Two NPs are assigned for the JVT efficiency, one for the central and the other for the forward jets.
\item Calibration of the $\met$. The uncertainties on $\met$ due to systematic shifts in the corrections for leptons and jets are accounted for in a fully correlated way in their evaluation for those physics objects, and are therefore not considered independently here. The systematic uncertainty assigned to the track-based soft term used in the $\met$ definition quantifies the resolution and scale of the soft term measurement by using the balance between hard and soft contributions in $Z\to\mu\mu$ events. These uncertainties are studied using the differences between Monte Carlo generators, using Powheg+Pythia8 as the nominal generator \cite{met_sys}. One NP is assigned for the soft-track scale, and two NPs for the soft-track resolution.
\item Jet flavour tagging systematics. The uncertainties on the $b$-tagging are assessed independently for $b$, $c$ and light-flavour quark jets\cite{btag_sys1}. The efficiencies are measured in data using the methods described in \cite{btag_sys2}-\cite{btag_sys3} with the 2015, 2016, 2017, and 2018 data set. There are 82 NPs assigned for the flavour tagging systematics with 19 NPs for light flavor, 19 for $c$, 44 for $b$.
\item Pileup. The uncertainty on the pileup reweighting is evaluated by varying the pileup scale factors by 1$\sigma$ based on the reweighting of the average interactions per bunch crossing. However, this uncertainty is highly correlated with the luminosity uncertainty and may be an overestimate.
\item Tau object systematics. These include the $\tauhad$ reconstruction, identification and trigger efficiencies, the efficiency for tau-electron overlap removal of true $\tauhad$ and true electrons faking $\tauhad$, and the efficiency for a ``medium'' BDT electron rejection. There are also three NPs that cover the tau energy scale (TES) systematics due to the modeling of the detector geometry (\texttt{TAU\_TES\_DETECTOR}), the measurement in the tag-and-probe analysis (\texttt{TAU\_TES\_INSITU}) and the \texttt{Geant4} shower model (\texttt{TAU\_TES\_MODEL}). They are evaluated based on detailed MC variation study, as well as the Run-2 $Z\to\tau\tau$ data for insitu calibrations of the tau TES and trigger efficiencies, as documented in \cite{tau_sys1} and the dedicated software tools \cite{tau_sys2} recommended by the Tau CP Woking Group \cite{TauCP}.
\end{itemize}

\subsection{Uncertainties on fake background estimations}
\label{sec:syst_datadriven}

Systematic uncertainties on the fake background as described in Sec. \ref{sec:background} are considered in the final fit.
The uncertainties of the fake estimation are correlated among all the leptonic channels and among all the hadronic channels,
respectively, but independent between them.

In the leptonic channels, they are named \texttt{fakeSFNP\_Xp\_ptY\_*} (X=1,3 indicating the number of tracks. Y=0,1,2 indicating the $\pt$ bins.) for tau fakes modelled by MC and \texttt{ABCD*} for QCD lepton fakes modelled by ABCD method.

In the hadronic channels, they are named \texttt{FFNP\_Xprong\_ptbinY\_etabinZ} (X=1,3 indicating the number of tracks. Y=0,1,2 indicating the $\pt$ bin. Z=0,1 indicating the central taus and forward taus.) for the statistical uncertainties of the FFs derived from the W+jets control region. \texttt{FFNP\_OS\_CR} and \texttt{FFNP\_SS\_CR} are one-sided NP for the systematic uncertainties of the FFs derived in the OS and SS control regions respectively. \texttt{``Only $\tau_\mathrm{sub}$ real modelling''} is the uncertainty of the MC modelling of the events with leading tau fake but sub-leading tau real, which is varied by 50\% to be conservative according to the study in the leptonic channels.

\subsection{Theoretical uncertainties on the background}

Theoretical uncertainties have been applied to the MC background in this analysis. The NNPDF3.0 systematic set (which has 100 variations: PDFset=26001-26100) is used to get the variation envelope around the nominal PDF.

The $\alpha_s$ uncertainty is applied using weights PDFset=26600,26500. The impact is insignificant and pruned before the fit.

The renormalization and factorization scales are varied by a factor of 0.5 and 2.0 around the nominal values. There are eight such variations. In the final BDT distributions, the largest variations of the eight per bin are taken. The name of this theoretical NP is called ``scale'' in the final fit.

The ISR and FSR uncertainty are obtained by weights:
\begin{itemize}
	\item FSR up: ``isr:muRfac=10\_fsr:muRfac=05''
	\item FSR down: ``isr:muRfac=10\_fsr:muRfac=05''
	\item ISR up: ``Var3cUp''
	\item ISR down: ``Var3cDown''
\end{itemize}

The theory uncertainty are applied with both shapes and normalisations hence no additional k-factor normalisation uncertainty is applied.

The default $t\bar{t}$ MC events (DSID=410470) are showered with Pythia8. A separate sample showered with Herwig7 (DSID=410557+410558, version 7.0.4) is compared with Pythia8 sample (DSID=410470), and the difference is treated as fragmentation and hadronization systematics \cite{ttbarSys}. These two samples are both generated with ATLFAST-II \cite{AFII}, and their difference is then applied to the default full-simulation $t\bar{t}$ sample, shown as ``$\bar{t}t$ PS'' in the ranking plots.

The default $t\bar{t}$ sample is generated with full simulated Powheg. Separate AFII aMC (DSID=410464+410465,version 2.3.3) and Powheg (DSID=411288) samples are generated, both with Matric Element Correction (MEC) set to off. The difference between those two is treated as the hard scattering systematics \cite{ttbarSys}, shown as ``ME'' in the ranking plots.

%The Powheg+Pythia8 $t\bar{t}$ MC is also generated with different shower radiations (initial and final-state radiation modelling). For a sample with increased radiation, the factorisation and renormalization scales are scaled by 0.5 with respect to their nominal values, the \texttt{hdamp} parameter (which controls the amount of radiation produced by the parton shower in \texttt{POWHEG-BOX v2}) is set to $3 m_{\text{top}}$ and the \texttt{A14var3cUp} tune is used. Conversely, for a sample with decreased radiation, the two scales are scaled by 2 with respect to their nominal values, the \texttt{hdamp} is kept at the nominal value of $1.5 m_{\text{top}}$ and the \texttt{A14var3cDown} tune is used \cite{ttbarSys}.

%Uncertainty affecting the normalisation of the $V$+jets and di-boson background is estimated to be about $5\%$ according to the PMG. The uncertainty on single top sross section is $+5\%$/$-4\%$ \cite{WtXsec}\cite{st_uncert_1,st_uncert_2}, on $t\bar{t}V$ $15\%$ \cite{ttV_uncert_1,ttV_uncert_2}, and on $t\bar{t}H$ $+10\%$/$-13\%$ \cite{ttH_uncert}.

\subsection{Uncertainties on the signal modelling}

An additional $1.6\%$ uncertainty on BR($H\to\tau\tau$) (Named as HttBR in the Ranking plots.) is also assigned \cite{HiggsBR} besides the theoretical uncertainties: PDF, $\alpha_s$, ISR, FSR and scale.

In the leptonic channels, the fake tau calibration is also applied to the fake tau part of the signal the same way as the background and treated correlatedly.

The PS uncertainty of the decay mode signal is applied as a normalisation derived from the relative yield difference between the $\ttbar$ samples, independently in each signal region. The yield variation of the PS and ME before the event selection are all smaller than 10\%. So in some regions with low $\ttbar$ yield, the normalisation is constrained to be between 0.9 to 1.1, shown as ``signal PS'' in the ranking plots. This solution is temporary. Alternative signal samples will be generated using Herwig7 to be compared with default to evaluate the PS uncertainties. The Herwig7 samples are still under processing (https://its.cern.ch/jira/browse/ATLMCPROD-9264).
