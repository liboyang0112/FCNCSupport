\section{FCNC signal samples}
\label{sec:fcncbkg}

The targeted signal in this analysis is $tqH/tH$ with $\Htautau$ (samples 411170-411177 and 412098-412105) in App. \ref{sec:DSIDlist}).
%In addition to the jet faking $\tauhad$ background, there is also background from fake leptons that do not come from prompt decays of $W$, $Z$ or tau lepton.
Considering the other decays of the Higgs can be part of the signal, samples xxxxxx-xxxxxx (To be added with the samples used by tH bb group) with inclusive $W$ and Higgs decays are also included. These sample have a one-lepton (electron or muon) filter at truth level (either coming from $W$ or Higgs decays). Events overlapping with xxxxxx-xxxxxx are removed based on truth information.

It is checked that after the final selection, there are 110 overlapped signal events caused by different overlap removal and object definition in xTauFramework and ttHMultiAna (27140 in total for hadhad channel and 95253 in total for lepton channels) but there is no overlap in the signal enriched region (BDT > 0.5).

The total FCNC signal with fake taus in this analysis is not used in the MVA training, but is regarded as part of the total signal in the fit. The normalization factor of the other components is common with the signal, so that their yields are fully correlated in the fit.

\section{Background estimation}
\label{sec:background}

The background events with real tau leptons are represented by Monte Carlo (MC) samples. These include $t\bar{t}$, $t\bar{t}+H/V$ and 
single top events with real taus, and $Z\to\tau\tau$+jets. The $Z\to ee,\mu\mu$ processes are included for lepton faking 
tau background.
The fake background with one or more taus faked by jets consists of the top fake (with at least one fake tau from jets in the top events), 
QCD multijet, $W$+jets and diboson events. Where the $t\bar t$ is dominant as shown in Figure \ref{fig:pt_raw}.

\input{\FCNCFigures/tex/pt_raw}

\subsection{Fake tau estimation in leptonic channels}
\label{sec:sf_method}

Due to the large yield in the leptonic channels, tighter tau selection is applied, which limits the use of control regions with loosened tau identifications. the QCD background is much smaller than Monte Carlo events, so the MC events are used to model the fake taus. The fake taus are calibrated using Data-Driven (DD) Scale Factors (SF) derived by comparing the normalization of fake-tau events in MC to data in the control regions.
This SF is then applied to correct the normalization of tau fakes in the MC yields. The excess of the events over these MC background is then from the multi-jets (QCD) faking background.

Top fake is the largest fake background in the total fake in the leptonic channels, which contributes around 70\% to 99\% in different regions.
Within the top fake events, fake taus can come from different origins, i.e., from jets (heavy/light flavor quark or gluon initiated) 
or leptons (electron or muon). The tau fake 
origins are checked with the top MC. Three dedicated top pair production control regions are define for:
\begin{itemize}
\item{W-jet faking tau: exactly 1 lepton, exactly 1 tau candidate, at least 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge.}
\item{B-jet faking tau: 2 leptons with different flavors or away from Z pole ($M_{ll}>100\GeV$ or $M_{ll}<90\GeV$), exactly 1 tau candidate, exactly 1 b-tagged jet.}
\item{Radiation faking tau: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate, at least two jets with exactly 2 b-tagged jets.}
\end{itemize}
$\met > 20$GeV is required for the top control regions to ensure that QCD contribution is negligible. The detailed categorisation and plots are shown in Sec. \ref{sec:sf_method}.
Most of the fake taus come from quark initiated jets, but the flavor distributions in OS are similar to those in SS. 

%However, these differences are well reproduced in the VR regions, which are also shown in Figure \ref{fig:lh_fake_comp}. 
%Therefore, the VR events are important to cover systematics coming from fake tau origins as well. Similar fake origin 
%distributions in $\thadhad$ are shown in Figure \ref{fig:hh_fake_comp}, although the top fake is only subdominant, and statistical errors are larger.

%Although the method mentioned in the \ref{sec:sf_method_obsolete} was adopted by the tthML analysis, a new method is needed in this case. 
As shown in the Figure \ref{fig:pt_raw}, the data is generally over-estimated in the OS regions while it is opposite in the SS region. If the fake taus are corrected by the same scale factors, this mismodelling will never get solved. This asymmetry of the SS and OS fake taus can be interpreted by the mis-modelling of the fake tau charges. Since the fake taus mainly come from light-flavored jets as shown in Figure \ref{fig:wjet_pt}, the mis-modelling is related to the charge carried by the jets. In conclusion, the mis-modelling is originated from the charge correlation between the jet which is faking a tau and the lepton. So the parent of the jet is believed to be charge correlated with the lepton. Considering the main background is $\bar{t}t$ process. The only suspect is the hadronic $W$ boson. In order to find the contribution of w-jet faking taus ($\tau_{W}$).  the truth information is used to match between the w-jet and the fake tau with $\Delta R < 0.4$. As shown in the Figure \ref{fig:wjet_pt}, there is a considerable amount of $\tau_{W}$'s in both SS and OS regions. There are four kinds of fake taus that need to be calibrated: Type1) $\tau_{W}$'s with the opposite charge to the lepton; Type2) $\tau_{W}$'s with the same charge as the lepton; Type 3) the fake taus from b-jets; Type4) the fake taus from other origins(mainly radiations). The following control regions are used to calibrate the four types.

%As presented in the Sec. \ref{sec:fake_origin}, the fake taus should be calibrated based on the three origins. The following top control regions are defined. A simulteneous fit is done in these region by floating the normalisation of the three kinds of fake taus. The fit result is shown in the Table \ref{tab:scale_factor}.

\begin{itemize}
\item{$2l1tau1bnj$: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate,  exactly 1 b-tagged jets.}
\item{$2l1tau2bnj$: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate,  exactly 2 b-tagged jets.}
\item{$1l1tau2b2j SS$: Exactly 1 lepton, exactly 1 tau candidate, exactly 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge.}
\item{$1l1tau2b2j OS$: Exactly 1 lepton, exactly 1 tau candidate, exactly 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the opposite charge.}
\item{$1l1tau2b3j SS$: Exactly 1 lepton, exactly 1 tau candidate, at least 5 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge.}
\item{$1l1tau2b3j OS$: Exactly 1 lepton, exactly 1 tau candidate, at least 5 jets with exactly 2 b-tagged. Tau candidate and lepton have the opposite charge.}
\end{itemize}

Where di-lep regions ($2l1tau1b$ and $2l1tau2b$) are used to calibrate the Type3 and Type4 fake taus. These regions are dominated by the bjet and the radiation jet faking taus. $1l1tau2b2j OS$ and $1l1tau2b3j OS$ are used to calibrate Type1 fake taus. Compared to the signal region, this region has an additional b-jet. So the $\bar{t}t$ background is enhanced in this region and signal is depleted. Similarly for the Type2, regions $1l1tau2b2j SS$ and $1l1tau2b3j SS$ are chosen. The components of these regions are shown in Figure \ref{fig:wjet_pt_CR}. A simultaneous fit is made to derive the scale factors for the fake taus. There are four parameters needed to be decided (the scale factors for the 4 types). But considering the $p_{T}$ and number of tracks depencence of the tau reconstruction, the scale factors are derived in 3 $\pt$ slices (25-35, 35-45, 45-)GeV and 1/3 prong taus. So there are 24 parameters to be decided. The results are shown in table \ref{tab:scale_factor_1prong_statonly} and \ref{tab:scale_factor_3prong_statonly}. Where the errors are statistical only. The post-fit plots are shown in Figure \ref{fig:wjet_pt_postfit_CR}. Then the scale factors are applied to the corresponding single b-jet regions. In $l\thadhad$ channel, both taus can be fake, so the calibration is done to them separately, following the same procedure as $\tlhad$ channels using the lepton and fake tau charges, then the scale factors are multiplied together. The nominal value of the scale factors will vary along with other CP and theory uncertainties in the final fit.

\begin{table}
\caption{The scale factors for 1 prong fake taus in different $\pt$ bins derived from the fit.}
\label{tab:scale_factor_1prong_statonly}
\input{\FCNCTables/fakeTauFit/scale_factor_1prong_statonly}
\end{table}
\begin{table}
\caption{The scale factors for 3 prong fake taus in different $\pt$ bins derived from the fit.}
\label{tab:scale_factor_3prong_statonly}
\input{\FCNCTables/fakeTauFit/scale_factor_3prong_statonly}
\end{table}
\input{\FCNCFigures/tex/wjet_pt}
\input{\FCNCFigures/tex/wjet_pt_CR}
\input{\FCNCFigures/tex/wjet_pt_postfit_CR}
\input{\FCNCFigures/tex/wjet_pt_postfit}

\subsection{QCD fake background in $\tlhad$ and $l\thad$ regions}

After the fake tau calibration, the fake contribution from QCD with both lepton and tau faked is estimated using ABCD method. For each $\tlhad$ and $l\thad$ signal regions, 4 blocks are defined as follows:

\begin{itemize}
	\item A: $E_T^{miss}<20$GeV, PLV not tight
	\item B: $E_T^{miss}<20$GeV, PLV tight
	\item C: $E_T^{miss}>20$GeV, PLV not tight
	\item D: $E_T^{miss}>20$GeV, PLV tight
\end{itemize}
The transfer factors are measured in each signal region as $r=\frac{N_B}{N_A}$. Where $N_A$ and $N_B$ are the yields calculated by data-MC where MC includes real lepton background with real taus or calibrated fake taus. The results are shown in Table \ref{tab:FF}. The uncertainties in the table for each region contains statistical uncertainties during the calculation and the potential signal contribution ($BR=0.2\%$). In principle for the QCD estimation, the transfer factor should not depend on the number of jets and charge. So all of the 4 measurements are taken into consideration to derive a univeral transfer factor. The central value and statistical uncertainty of the transfer factor are derived using likelihood method separately for election and muons. The systematics variation is taken by calculating the second moment of the four measurement (The power is $1/\sigma^2$). The combined result is shown as the last line in the table with both statistics and systematics considered, where the statistical uncertainty for electron and muon are 0.13 and 0.07 respectively, which indicates that the systematic uncertainties are comparable with the statistical uncertainties, meaning that there is no big deviation among the 4 measurements.

\begin{table}
\caption{The QCD transfer factor derived from different low $E_T^{miss}$ control regions}
\label{tab:FF}
\input{\FCNCTables/FF/fakeFactor}
\end{table}

Finally the QCD contribution in D is then estimated as $r$D. The signal region is redefined as D.
The data-MC comparison after the fake tau and fake lepton estimation is show in Figure \ref{fig:wjet_pt_postfit}.


\subsection{Fake tau estimate in hadronic channels}
\label{sec:ss_method}

In the hadronic channels, the QCD also contributes to the fake tau background. So the QCD and top fake background are estimated together using loose tau control regions.

The $\tauhad$ $\pt$ spectra in the $\thadhad$ SS and OS are shown in Figure \ref{fig:os_pre_hadhad}, where the data is far beyond the background prediction, which only contains real tau background. A Fake Factor Method developed by $\Htautau$ group \cite{Htautau-note} is adopted and customized for this analysis. 

The following regions are defined to estimate the fake taus in STH $\thadhad$ channel as shown in Figure \ref{fig:regions_hadhad}:

\begin{figure}[htb]
\centering
\includegraphics[width=0.45\textwidth]{\FCNCFigures/xTFW/otherPlots/regions.png}
\caption{Pictorial representation of the fake-factors relevant region for $\tauhad$ channel.}
\label{fig:regions_hadhad}
\end{figure}

\begin{itemize}
\item{$2mtau1b2jos$ (SR): 2 opposite charged $\tauhad$ with medium RNN ID, one b-jet, exactly 2 light flavor jets.}
\item{$1m1ntau1b2jos$ (Purple): 2 opposite charged $\tauhad$ with leading one passing RNN medium, subleading one failing RNN medium, one b-jet, exactly 2 light flavor jets.}
\item{$1n1mtau1b2jos$ (Blue): 2 opposite charged $\tauhad$ with subleading one passing RNN medium, leading one failing RNN medium, one b-jet, exactly 2 light flavor jets.}
\item{$1l1ntau1b2jos$ (Orange): 2 opposite charged $\tauhad$ with leading one RNN loose-not-medium, subleading one failing RNN medium, one b-jet, exactly 2 light flavor jets.}
\item{$1n1ltau1b2jos$ (Green): 2 opposite charged $\tauhad$ with subleading one RNN loose-not-medium, leading one failing RNN medium, one b-jet, exactly 2 light flavor jets.}
\end{itemize}

The fake events in the signal regions will be represented by the templates of fake taus in these control regions with proper fake factors. The templates are aquired by subtracting all real $\tauhad$ background contributions from data.

Two sets of fake-factors (FF) were computed in the W+jets control region (1 lepton + 1 tau, no b-jet) by the $\Htautau$ group \cite{Htautau-note} as listed in Table \ref{tab:FF_htautau_1p}, Table \ref{tab:FF_htautau_3p}, defined as not-medium FFs (nm) and loose-not-medium FFs (lnm) in Eq. \ref{eq:hadhad_FF}. They are computed in three regions with different tau ID requirment. The FFs(nm) is the ratio of the Data-MC(real tau) yields with passing medium tau ID to which failing the medium tau ID. For FFs(lnm) calculation, the only difference is that the loose tau ID is further required for the events failing the medium tau ID. A 2-dimensional parametrization for the FFs is employed relying on $\pt$ and $\eta$.

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 1p taus derived by the $\Htautau$ group.}
\label{tab:FF_htautau_1p}
\input{\FCNCTables/xTFW/FF/FF_nominal_1p}
\end{table}

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 3p taus derived by the $\Htautau$ group.}
\label{tab:FF_htautau_3p}
\input{\FCNCTables/xTFW/FF/FF_nominal_3p}
\end{table}

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 1p taus derived by us in same-sign regions.}
\label{tab:FF_ss_1p}
%\input{\FCNCTables/xTFW/FF_htautau}
\input{\FCNCTables/xTFW/FF/FF_sys_ss_1p}
\end{table}

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 3p taus derived by us in same-sign regions.}
\label{tab:FF_ss_3p}
%\input{\FCNCTables/xTFW/FF_htautau}
\input{\FCNCTables/xTFW/FF/FF_sys_ss_3p}
\end{table}

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 1p taus derived by us in sideband regions.}
\label{tab:FF_sb_1p}
%\input{\FCNCTables/xTFW/FF_htautau}
\input{\FCNCTables/xTFW/FF/FF_sys_sb_1p}
\end{table}

\begin{table}
\caption{$FF_{lnm}$ (first) and $FF_{nm}$ (second) for 3p taus derived by us in sideband regions.}
\label{tab:FF_sb_3p}
%\input{\FCNCTables/xTFW/FF_htautau}
\input{\FCNCTables/xTFW/FF/FF_sys_sb_3p}
\end{table}

\begin{equation}
\label{eq:hadhad_FF}
\begin{aligned}
F F_{\mathrm{nm}}&=(\text { Data }-\mathrm{MC})_{\text {medium } \tau_{\text {had-vis }}}^{\mathrm{WCR}} /(\text { Data }-\mathrm{MC})_{\text {not-medium}\ \tau_{\text{had-vis}}}^{\mathrm{WCR}}
\\
F F_{\mathrm{lnm}}&=(\text { Data }-\mathrm{MC})_{\text {medium } \tau_{\text {had-vis }}}^{\mathrm{WCR}} /(\text { Data }-\mathrm{MC})_{\text {loose-not-medium}\ \tau_{\text{had-vis}}}^{\mathrm{WCR}}
\end{aligned}
\end{equation}

From the fake-factor definition, the events with both taus fake in the SR can be represented either by $F F_{\operatorname{lnm}}\left(\tau_{0}\right) \cdot F F_{\mathrm{nm}}\left(\tau_{1}\right)$ times $1l1ntau1b2jos$ or $F F_{\mathrm{nm}}\left(\tau_{0}\right) \cdot F F_{\mathrm{lnm}}\left(\tau_{1}\right)$ times $1n1ltau1b2jos$. So the final estimation is the average of those two.

The events with only one fake $\tauhad$ is represented by the events in $1m1ntau1b2jos$ and $1n1mtau1b2jos$, which are scaled by $F F_{\mathrm{nm}}\left(\tau_{1}\right)$ and $F F_{\mathrm{nm}}\left(\tau_{0}\right)$ respectively. The procedure is summarized as:

\begin{equation}
\tau_{1}^{P} \tau_{2}^{P}=\tau_{1}^{T} \tau_{2}^{T}(\mathrm{MC})+F F_{2} \tau_{1}^{P} \tau_{2}^{F}+F F_{1} \tau_{1}^{F} \tau_{2}^{P}-F F_{1} F F_{2} \tau_{1}^{F} \tau_{2}^{F}
\end{equation}

where P means passing $\thadhad$ ID, T means truth $\tauhad$, therefore, the equation illustrates the contribution of events with two RNN medium $\thadhad$ is estimated through the combination of $1m1ntau1b2jos$, $1n1mtau1b2jos$, $2ltau1b2jos$,$1l1ntau1b2jos$,$1n1ltau1b2jos$.

For TTH $\thadhad$ region, the definition is the same except that the number of light jets requirement is at least 3 ($*3jos$). 

The uncertainties of this method consists of three parts:
\begin{itemize}

\item The statistical uncertainties during the FF derivation, one for each FF.

\item The FF is rederived in the SS CR using $1m1ntau1b2jss+1m1ntau1b3jss$, $1n1mtau1b2jss+1n1mtau1b2jss$, and $2mtau1b2jss+2mtau1b3jss$ to account for the limitations of the parametrization of the fake-factors. The fake factor are presented in Table \ref{tab:FF_ss_1p}, \ref{tab:FF_ss_3p}.

\item The FF is rederived in the OS SR side band with $m_{\tau\tau,vis}>130$GeV using $1m1ntau1b2jos+1m1ntau1b3jos$, $1n1mtau1b2jos+1n1mtau1b2jos$, and $2mtau1b2jos+2mtau1b3jos$ to account for the different contribution from each origin of the fake taus. The fake factor are presented in Table \ref{tab:FF_sb_1p},  \ref{tab:FF_sb_3p}.

\end{itemize}

\begin{figure}[htb]
\centering
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/raw/NOMINAL/reg2mtau1b2jos_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(a1)}}
\put(-120, 130){\footnotesize{STH $\thadhad$ (OS)}}
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/raw/NOMINAL/reg2mtau1b2jos_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(b1)}}
\put(-120, 130){\footnotesize{TTH $\thadhad$ (OS)}}\\
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/raw/NOMINAL/reg2mtau1b3jss_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(a2)}}
\put(-120, 130){\footnotesize{STH $\thadhad$ (SS)}}
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/raw/NOMINAL/reg2mtau1b3jss_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(b2)}}
\put(-120, 130){\footnotesize{TTH $\thadhad$ (SS)}}
\caption{ The distributions of leading $\tau$ $\pt$ in the STH (a), and TTH (b) $\thadhad$ SR (1) and SS CR (2) before the fake estimation. Data is more than the MC prediction because the fake tau backgrounds are not yet added.}
\label{fig:os_pre_hadhad}
\end{figure}

% The excess of the SS events over MC with truth taus are used to estimate the fake tau background in OS from QCD multi-jets in the $% \thadhad$ + jets channel:   
% \begin{equation}
% N_{\text{QCD fake}}^{\text{OS}} =f_{\text{norm}}\cdot (N_{\text{data}}^{\text{SS}} - N_{\text{MC}}^{\text{SS}}),
% \label{eq:eq10}
% \end{equation}
% 
% where $f_{\text{norm}}$ is a ratio of OS and SS from multi-jets QCD, 
% $N_{\text{data}}^{\text{SS}}$, and $N_{\text{MC}}^{\text{SS}}$ are observed data and estimated MC predictions in the SS regions. 
% 
% The $f_{\text{norm}}$ is measured separately to be $1.32\pm 0.03$ in the signal-depleted
% one $b$-tag events with $BDT<0.5$ and $1.6\pm 0.1$ in the double $b$-tagged  $\thadhad$ +$\ge$ 3jets events,
% which provides a good closure test of QCD fake tau estimation. We take the difference between these
% two values as a systematics for the method and assign $f_{\text{norm}}=1.3\pm 0.3$ for the analysis.

Figure~\ref{fig:pt_frs} shows the leading $\tauhad$ $\pt$ distribution from the SR and SS CR in the hadronic channels.

\begin{figure}[htb]
\centering
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/showFake/NOMINAL/reg2mtau1b2jos_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(a1)}}
\put(-120, 130){\footnotesize{STH $\thadhad$ OS}}
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/showFake/NOMINAL/reg2mtau1b3jos_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(b1)}}
\put(-120, 130){\footnotesize{TTH $\thadhad$ OS}}\\
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/showFake/NOMINAL/reg2mtau1b2jss_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(a2)}}
\put(-120, 130){\footnotesize{STH $\thadhad$ SS}}
\includegraphics[page=6,width=0.45\textwidth]{\FCNCFigures/xTFW/showFake/NOMINAL/reg2mtau1b3jss_vetobtagwp70_highmet/tau_pt_0.pdf}
\put(-100, 140){\textbf{(b2)}}
\put(-120, 130){\footnotesize{TTH $\thadhad$ SS}}\\
\caption{ The distributions of leading $\tau$ $\pt$ in the STH (a), and TTH (b) $\thadhad$ SR (1) and SS CR (2) after fake estimation. }
\label{fig:pt_frs}
\end{figure}

\subsection{Summary of signal and background events}
\label{sec:background_hadhad}

The the expected yields of signal and background events in different regions after fake estimation are summarized in Table~\ref{tab:tthML_yield}, \ref{tab:xTFW_yield}.

\begin{table}
\caption{The yield of the background, data and each signal in leptonic channels after the fake estimation.}
\label{tab:tthML_yield}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL/yield_chart}
\end{table}

\begin{table}
\caption{The yield of the background, data and each signal in hadronic channels after the fake estimation.}
\label{tab:xTFW_yield}
\input{\FCNCTables/xTFW/showFake/NOMINAL/yield_chart}
\end{table}

\clearpage
