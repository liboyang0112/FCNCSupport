\section{Background estimation}
\label{sec:background}

\input{\FCNCFigures/tex/os_pre_hadhad}

The background events with real tau leptons are represented by Monte Carlo (MC) samples. These include $t\bar{t}$, $t\bar{t}+H/V$ and 
single top events with real taus, and $Z\to\tau\tau$+jets.

The $Z\to ee,\mu\mu$ processes are included for lepton faking tau background. The lepton faking taus are dominated by electrons which is studied by the tau working group. The e-veto BDT cut is used to reduce this kind of background as mentioned in the Section \ref{sec:taurecon}. The corresponding scale factors are applied separately to true electrons and true taus with dedicated uncertainties \cite{TauCP}. 

\input{\FCNCFigures/tex/pt_raw}

The fake background with one or more taus faked by jets consists of the top fake (with at least one fake tau from jets in the top events), QCD multijet, $W$+jets and diboson events.

In the hadronic channels, the real tau background is mostly from $Z\to\tau\tau$+jets and $t\bar t$  as shown in \ref{fig:os_pre_hadhad} where the MC only includes real taus. While the fake consists of both QCD multijet and $t\bar t$.

While the $t\bar t$ is dominant in the leptonic channels as shown in Figure \ref{fig:pt_raw} where the MC contains both fake tau and real tau contributions.

\subsection{Fake tau estimation in leptonic channels}
\label{sec:sf_method}

Due to the large yield in the leptonic channels, tighter tau selection is applied, which limits the use of control regions with loosened tau identifications. the QCD background is much smaller than Monte Carlo events, so the MC events are used to model the fake taus. The fake taus are calibrated using Data-Driven (DD) Scale Factors (SF) derived by comparing the normalization of fake-tau events in MC to data in the control regions.
This SF is then applied to correct the normalization of tau fakes in the MC yields. The excess of the events over these MC background is then from the multi-jets (QCD) faking background.

Top fake is the largest fake background in the total fake in the leptonic channels, which contributes around 70\% to 99\% in different regions.
Within the top fake events, fake taus can come from different origins, i.e., from jets (heavy/light flavor quark or gluon initiated) or leptons (electron or muon). The tau fake origins are checked with the top MC. Dedicated top pair production control regions are define for:
\begin{itemize}
\item{W-jet faking tau: exactly 1 lepton, exactly 1 tau candidate, at least 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge, separated into $1l1tau2b2j SS$, $1l1tau2b2j SS$, $1l1tau2b2j SS$, $1l1tau2b2j SS$.}
\item{B-jet faking tau: 2 leptons with different flavors or away from Z pole ($M_{ll}>100\GeV$ or $M_{ll}<80\GeV$), exactly 1 tau candidate, exactly 1 b-tagged jet, later refered as $2l1tau1bnj$.}
\item{Radiation faking tau: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate, at least two jets with exactly 2 b-tagged jets, later refered as $2l1tau2bnj$.}
\end{itemize}

\input{\FCNCFigures/tex/wjet_pt}

As shown in the Figure \ref{fig:pt_raw}, most of the fake taus come from quark initiated jets, but the flavor distributions in OS are similar to those in SS. The data is generally over-estimated in the OS regions while it is opposite in the SS region. If the fake taus are corrected by the same scale factors, this mismodelling will never get solved. This asymmetry of the SS and OS fake taus can be interpreted by the mis-modelling of the fake tau charges. Since the fake taus mainly come from light-flavored jets as shown in Figure \ref{fig:wjet_pt}, the mis-modelling is related to the charge carried by the jets. In conclusion, the mis-modelling is originated from the charge correlation between the jet which is faking a tau and the lepton. So the parent of the jet is believed to be charge correlated with the lepton. Considering the main background is $\bar{t}t$ process. The only suspect is the hadronic $W$ boson. In order to find the contribution of w-jet faking taus ($\tau_{W}$).  the truth information is used to match between the w-jet and the fake tau with $\Delta R < 0.4$. As shown in the Figure \ref{fig:wjet_pt}, there is a considerable amount of $\tau_{W}$'s in both SS and OS regions. There are four kinds of fake taus that need to be calibrated: Type1) $\tau_{W}$'s with the opposite charge to the lepton; Type2) $\tau_{W}$'s with the same charge as the lepton; Type 3) the fake taus from b-jets; Type4) the fake taus from other origins(mainly radiations). The following control regions are used to calibrate the four types.

The control regions are similar to signal regions but with an additional b-jet or lepton as defined below. In the control regions with single lepton, $\met > 20$GeV and at least 2 light jets are required to ensure that QCD contribution is negligible. The yield of the control regions are listed in Table \ref{tab:SFCR_yield} and \ref{tab:SFCR_yield_1}.

\begin{itemize}
\item{$2l1tau1bnj$: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate,  exactly 1 b-tagged jets.}
\item{$2l1tau2bnj$: 2 leptons with different flavors or away from Z pole, exactly 1 tau candidate,  exactly 2 b-tagged jets.}
\item{$1l1tau2b2j SS$: Exactly 1 lepton, exactly 1 tau candidate, exactly 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge.}
\item{$1l1tau2b2j OS$: Exactly 1 lepton, exactly 1 tau candidate, exactly 4 jets with exactly 2 b-tagged. Tau candidate and lepton have the opposite charge.}
\item{$1l1tau2b3j SS$: Exactly 1 lepton, exactly 1 tau candidate, at least 5 jets with exactly 2 b-tagged. Tau candidate and lepton have the same charge.}
\item{$1l1tau2b3j OS$: Exactly 1 lepton, exactly 1 tau candidate, at least 5 jets with exactly 2 b-tagged. Tau candidate and lepton have the opposite charge.}
\end{itemize}


\begin{table}
\caption{The yield in the control regions used to derive fake tau SFs.}
\label{tab:SFCR_yield}
\input{\FCNCTables/tthML/showFake/faketau/prefit/NOMINAL_SFCR/yield_chart}
\end{table}
\begin{table}
\caption{The yield in the control regions used to derive fake tau SFs.}
\label{tab:SFCR_yield_1}
\input{\FCNCTables/tthML/showFake/faketau/prefit/NOMINAL_SFCR/yield_chart_1}
\end{table}

Where di-lep regions ($2l1tau1b$ and $2l1tau2b$) are used to calibrate the Type3 and Type4 fake taus. These regions are dominated by the bjet and the radiation jet faking taus. $1l1tau2b2j OS$ and $1l1tau2b3j OS$ are used to calibrate Type1 fake taus. Compared to the signal region, this region has an additional b-jet. So the $\bar{t}t$ background is enhanced in this region and signal is depleted. Similarly for the Type2, regions $1l1tau2b2j SS$ and $1l1tau2b3j SS$ are chosen. The components of these regions are shown in Figure \ref{fig:wjet_pt_CR}. A simultaneous fit is made to derive the scale factors for the fake taus. There are four parameters needed to be decided (the scale factors for the 4 types). But considering the $p_{T}$ and number of tracks depencence of the tau reconstruction, the scale factors are derived in 3 $\pt$ slices (25-35, 35-45, 45-)GeV and 1/3 prong taus. So there are 24 parameters to be decided. The results are shown in table \ref{tab:scale_factor_1prong_statonly} and \ref{tab:scale_factor_3prong_statonly}. Where the errors are statistical only. The post-fit plots are shown in Figure \ref{fig:wjet_pt_postfit_CR}. Then the scale factors are applied to the corresponding single b-jet regions. In $l\thadhad$ channel, both taus can be fake, so the calibration is done to them separately, following the same procedure as $\tlhad$ channels using the lepton and fake tau charges, then the scale factors are multiplied together. The nominal value of the scale factors will vary along with other uncertainties from combined preformace (CP) recommendations and theory uncertainties in the final fit.

\begin{table}
\caption{The scale factors for 1 prong fake taus in different $\pt$ bins derived from the fit.}
\label{tab:scale_factor_1prong_statonly}
\input{\FCNCTables/fakeTauFit/scale_factor_1prong_statonly}
\end{table}
\begin{table}
\caption{The scale factors for 3 prong fake taus in different $\pt$ bins derived from the fit.}
\label{tab:scale_factor_3prong_statonly}
\input{\FCNCTables/fakeTauFit/scale_factor_3prong_statonly}
\end{table}

\input{\FCNCFigures/tex/wjet_pt_CR}
\input{\FCNCFigures/tex/wjet_pt_postfit_CR}

\subsection{QCD fake background in $\tlhad$ and $l\thad$ regions}
\label{sec:ABCD}
After the fake tau calibration, the fake contribution from QCD with both lepton and tau faked is estimated using ABCD method. For each $\tlhad$ and $l\thad$ signal regions, 4 blocks are defined as follows:

\begin{itemize}
	\item A: $E_T^{miss}<20$GeV, PLV not tight
	\item B: $E_T^{miss}<20$GeV, PLV tight
	\item C: $E_T^{miss}>20$GeV, PLV not tight
	\item D: $E_T^{miss}>20$GeV, PLV tight
\end{itemize}

The yields in each A, B, C, D regions are shown in Table \ref{tab:ABCDYield} - \ref{tab:ABCDYield_3}.

\begin{table}
\caption{The yields in each A, B, C, D regions.}
\label{tab:ABCDYield}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL/yield_chart}
\end{table}

\begin{table}
\caption{The yields in each A, B, C, D regions.}
\label{tab:ABCDYield_1}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL/yield_chart_1}
\end{table}

\begin{table}
\caption{The yields in each A, B, C, D regions.}
\label{tab:ABCDYield_2}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL/yield_chart_2}
\end{table}

\begin{table}
\caption{The yields in each A, B, C, D regions.}
\label{tab:ABCDYield_3}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL/yield_chart_3}
\end{table}

\begin{table}
\caption{The QCD transfer factor derived from different low $E_T^{miss}$ control regions}
\label{tab:FF}
\input{\FCNCTables/FF/fakeFactor}
\end{table}

The transfer factors are measured in each signal region as $r=\frac{N_B}{N_A}$. Where $N_A$ and $N_B$ are the yields calculated by data-MC where MC includes real lepton background with real taus or calibrated fake taus. The results are shown in Table \ref{tab:FF}. The uncertainties in the table for each region contains statistical uncertainties during the calculation and the potential signal contribution ($BR=0.2\%$). In principle for the QCD estimation, the transfer factor should not depend on the number of jets and charge. So all of the 4 measurements are taken into consideration to derive a universal transfer factor. The central value and statistical uncertainty of the transfer factor are derived using likelihood method separately for electron and muons. The systematics variation is taken by calculating the second moment of the four measurements (The power is $1/\sigma^2$). The combined result is shown as the last line in the table with both statistics and systematics considered, where the statistical uncertainty for electron and muon are 0.13 and 0.07 respectively, which indicates that the systematic uncertainties are comparable with the statistical uncertainties, meaning that there is no big deviation among the 4 measurements.


Finally the QCD contribution in D is then estimated as $r$D.
The data-MC comparison after the fake tau and fake lepton estimation is show in Figure \ref{fig:wjet_pt_postfit}.


A closure test is make for the background estimations in the low BDT region (BDT score < -0.6). The transfer factor derived in the low BDT region is shown in the Table \ref{tab:fakeFactor_closure}. The leading lepton $\pt$ distribution in the low BDT is shown in Figure \ref{fig:closuretest}. The yield is shown in Table \ref{tab:closureYield}.

\input{\FCNCFigures/tex/wjet_pt_postfit}
\input{\FCNCFigures/tex/closureTest}

\begin{table}
\caption{The yield in the low BDT region where the QCD faking estimation in the leptonic channels are tested.}
\label{tab:closureYield}
\input{\FCNCTables/tthML/showFake/faketau/postfit/NOMINAL_closureTest/yield_chart}
\end{table}


\begin{table}
\caption{The QCD transfer factor derived from low BDT regions as closure test.}
\label{tab:fakeFactor_closure}
\input{\FCNCTables/FF/fakeFactor_closure}
\end{table}

\newpage
\subsection{Fake tau estimate in hadronic channels}
\label{sec:ss_method}

In the hadronic channels, the QCD also contributes to the fake tau background which doesn't have MC samples. The $\tauhad$ $\pt$ spectra in the $\thadhad$ SS and OS are shown in Figure \ref{fig:os_pre_hadhad}, where the data is far beyond the background prediction, which only contains real tau background. A Fake Factor Method developed by $\Htautau$ group \cite{Htautau-note} is adopted and customized for this analysis. The QCD and part of MC fake background are estimated together using anti tau ID control regions defined bellow. The yield in the Fake-CR is shown in the Table \ref{tab:hadronic_nm_yield}. 

\begin{itemize}
\item{Fake-CR: 2 opposite charged $\tauhad$ with leading one passing RNN medium, subleading one failing RNN medium, other requirements are the same as SR (one for each STH $\thadhad$ and TTH $\thadhad$ SR).}
\end{itemize}

\begin{table}
\caption{The yield in the not-medium region.}
\label{tab:hadronic_nm_yield}
\input{\FCNCTables/xTFW/showFake/NOMINAL/yield_chart_nm}
\end{table}

Since the sub-leading tau ID is reversed, the Fake-CR have most of events with fake sub-leading tau. However there are events with leading taus fake but sub-leading taus real in the SR where both taus are equally medium. These events can not be modelled by the events in Fake-CR. Fortunately the contribution of these events is minor compared to the other fake background as shown in the Table \ref{tab:yield_SR} and Figure \ref{fig:fakeEstimation_had} defined as ``Only $\tau_{sub}$ real''. So they can be modelled by MC with the shape uncertainty neglected and the normalisation uncertainty can be applied according to fake studies in the leptonic channels (50\% to be conservative).

Then the events with fake sub-leading tau will be represented by the templates of fake taus in the Fake-CR with proper fake factors. The templates are aquired by subtracting all MC background contributions with real subleading taus from data.

The Fake-factors (FF) were computed in the W+jets control region (1 lepton + 1 tau, no b-jet) by the $\Htautau$ group \cite{Htautau-note} as listed in Table \ref{tab:FF_htautau}. They are computed in two regions with different tau ID requirment. The FFs are the ratio of the Data$-$MC$_\mathrm{real~tau}$ yields passing medium tau ID to which failing the medium tau ID. The FFs are calculated in 12 bins ($\eta,\pt,N_\mathrm{track}:2\times3\times2=12$).

The uncertainties of this method consists of three parts:
\begin{enumerate}

\item The statistical uncertainties during the FF derivation, one for each FF, 12 in total.

\item The FF is rederived in the SS CR (2 taus with same charge, at least 3 jets with exactly 1 b-tagged) to account for the limitations of the parametrization of the fake-factors as shown in Figure \ref{fig:ffsys}. The fake factor are presented in Table \ref{tab:FF_ss}. 

\item The FF is rederived in the OS CR (2 taus with opposite charge, at least 3 jets with exactly 1 b-tagged) with the events failing the cut chain in Table \ref{tab:cutflow_STHhadhad} and \ref{tab:cutflow_TTHhadhad} to account for the different contribution from each origin of the fake taus as shown in Figure \ref{fig:ffsys}. The fake factor are presented in Table \ref{tab:FF_sb}.

The yield in SS CR and OS CR and corresponding not-medium region are shown in Table \ref{tab:hadronic_CR_yield} and \ref{tab:hadronic_nmCR_yield}.

\begin{table}
\caption{The yield in SS CR and OS CR.}
\label{tab:hadronic_CR_yield}
\input{\FCNCTables/xTFW/showFake/NOMINAL/yield_chart_CR}
\end{table}

\begin{table}
\caption{The yield in the not-medium SS CR and OS CR.}
\label{tab:hadronic_nmCR_yield}
\input{\FCNCTables/xTFW/showFake/NOMINAL/yield_chart_nmCR}
\end{table}

\end{enumerate}

\input{\FCNCFigures/tex/ffsys}

Due to the low statistics in the high $\pt$ region, some fake factors are negative in SS CR or OS CR. Those FFs are treated as 0.

The tau $\pt$ distribution after fake estimation is shown in Figure \ref{fig:fakeEstimation_had}. Where the FF are derived for nominal and two systematics cases. The difference is small which indicates that the three sets of FFs are consistent with each other.

\input{\FCNCFigures/tex/fakeEstimation_had}

\begin{table}
\caption{FF derived by the $\Htautau$ group.}
\label{tab:FF_htautau}
\input{\FCNCTables/xTFW/FF/FF_nominal_1p3p}
\end{table}

\begin{table}
\caption{FF derived in SS CR.}
\label{tab:FF_ss}
\input{\FCNCTables/xTFW/FF/FF_sys_ss_1p3p}
\end{table}

\begin{table}
\caption{FF derived in OS CR.}
\label{tab:FF_sb}
\input{\FCNCTables/xTFW/FF/FF_sys_sb_1p3p}
\end{table}

\clearpage
