\section{Fit model and signal extraction}
\label{sec:fit}

The parameter of interest in this search is the signal strength of the FCNC interactions, BR($t\to Hq$) and corresponding production mode cross section. The statistical analysis of the data employs a binned likelihood function constructed as the product of Poisson probability terms, in bins of the BDT output.

To take into account the systematic uncertianties associated with the MC estimation from different sources for both the signal and background samples, the fit model incorporates these systematics as extra Gaussian or Log-Normal constraint terms multiplied with the combined likelihood. The fitted central values and errors of the systematics parameters, or NPs, are expected to follow a normal distribution centered around 0 with unit width, when the Asimov data is used. The fit model construction is obtained with the \texttt{RooFit} and \texttt{RooStats} software, and the model configuration and persistence files (as input to \texttt{RooStats}) are produced by \texttt{TRExFitter} \cite{TRExFitter}, which is a software package interface with \texttt{HistFactory}. The \texttt{TRExFitter} includes additional features such as histogram smoothing, NP pruning (as shown in Figure \ref{fig:xTFW_pruning_0}-\ref{fig:tthML_pruning_2}) and error symmetrization before the fits.
%A procedure called local symmetrization to the systematic variational histograms is implemented to semmetrize bins with one-sided variations which may cause problems in the fit.

The correlated bin-by-bin histogram variation corresponds to the up and down variation of each NP. The independent bin-by-bin fluctuations in the combined MC templates are also treated as NPs. They are incorporated in the model as extra Poisson constraint terms, and are expected to have a fitted value of 1 and a fitted error reflecting the relative statistical error in each particular bin. There is one parameter of interest (POI) freely floating in the fit without any constraints, namely, the signal strength $\mu$ (\texttt{SigXsecOverSM}) which is a multiplicative factor on a presumed branching ratio of BR($t\to Hq$)=$0.2\%$ in this analysis. The errors associated with the different systematics will be properly propagated to the fitted error of $\mu$ in a simultaneous fit of multiple regions via a profiled likelihood scan by the minimization program \texttt{MINUIT}. 

The one-sided NPs in the analysis, namely, \texttt{fakeSFXprongXPtbin}, \texttt{``ttbar fragmentation''}, \texttt{``ttbar hard scattering''}, \texttt{JET$\_$BJES$\_$Response}, \texttt{JET$\_$JER$\_$DataVsMC$\_$MC16}, \texttt{JET$\_$SingleParticle$\_$HighPt}, \texttt{JET$\_$TILECORR$\_$Uncertainty}, \texttt{MET$\_$SoftTrk$\_$ResoPara}, \texttt{MET$\_$SoftTrk$\_$ResoPerp} are symmetrized. This is done manually on the MC components of the background. By default, all the kinematic NPs (shape NPs due to, e.g., energy scales) are smoothed using the default smoothing parameters (set to 40) in \texttt{TRExFitter}. This helps removing the artificial NP constraints due to statistical fluctuations in the systematic variations, and makes the fit well behaved. %The NPs pull distributions before the smoothing for each SR are given in App. \ref{app:channel_fit}.

Figure~\ref{fig:fcnc_rank_data} shows the ranking of the 30 top NPs along with their pull distributions, produced also with {\texttt TRExFitter}. The highest ranked NP is defined to have the largest impact on $\mu$. The impact is evaluated by varying the NP under consideration by one $\sigma$ (either pre or post-fit error) up and down, and afterwards looking at the relative change in $\mu$ under the conditional fit where the NP under consideration is fixed to its varied new value.
Figure~\ref{fig:fcnc_pull_data} shows the pull distributions of all NPs in asimov fit. %The NPs which are constrained less than $80\%$ of their original error are smoothed with the default smoothing method in {\texttt TRExFitter}. The pre and post-smoothing distributions of the relevant NPs are given in App. \ref{app:smoothpruneNP}. Similar pull distributions before the NP smoothing are given in Figure \ref{fig:fcnc_pull_nosmooth} of App. \ref{app:smoothpruneNP}.
Normalization and shape systematics whose impact is less than $1\%$ are removed from the fit. %The list of removed NPs are given in App. \ref{app:smoothpruneNP}.

It is observed that the NP ``$\bar{t}t$ PS'' is highly constrained. The reason for this is further understood. As shown in App. \ref{sec:decor} in Figure \ref{fig:tuH_NuisPar_decorr} (left), the constraint is originated from signal regions with high statistics especially $t_h\tlhad 3j$. The NP impact on the background is shown in Figure \ref{fig:tthML_ttbarPS}. It is clear that the NP variation is around 2.5\% which is quite significant compared to the statistical uncertainty in the low BDT region. By inspecting the correlation matrix, the NP ``$\bar{t}t$ PS'' doesn't have correlation with other NPs significant enough to be released.

As shown in the plot on the right in Figure \ref{fig:tuH_NuisPar_decorr}. The constraint is mainly caused by the variation of ``$\bar{t}t$'' events with real taus.
This comes from the difference of the samples themselves and has nothing to do with the fake tau background estimation. The constraint is a little bit released in the $t_h\tlhad 3j$ region on the right plot. It is observed that the PS variation also has large impact in the $t\bar{t}$ CR, further more, this NP is also an issue in the FCNC $H\to \bar{b}b$ analysis.

% these questions are too confusing here and we need to check with experts for sure if they see any difference between pythia8 vs herwig7.1, commented for now. 

%So the question on the PS variation is translated to the questions to the $t\bar{t}$ MC analyses:
%\begin{itemize}
%	\item Why are those two samples so different?
%	\item Should the two AFII samples be calibrated separately?
%	\item Is this difference also observed in the studies on the top physics? If so, how is the constraint released?
%	\item Are the taus treated similarly in Herwig7 samples and Pythia8 samples?
%\end{itemize}

%The NP ranking and constraints can be qualitatively understood from the variations of the BDT distributions due to the relevant NPs. Figures \ref{fig:NPvar_rank_data_a}-\ref{fig:NPvar_rank_data_d} show the systematic variations due to the top ranked NPs. %All of them cause large variations in the high-BDT signal region, hence are ranked high. The \texttt{THEORY\_RADIATION} is also constrained to $<80\%$ due to bins where the systematic variation is much bigger than the statistical one. However, after smoothing, this NP is not constrained any more. 

%The latter two cause large variation in the signal region, but small variation in the low BDT background region. Thus, they have large impact on the fitted signal strength but are not much constrained by the fit. The first one causes large variations in the background region, but it is an overall shift effect which can be adjusted by the fit through the floating normalization factors of the fake. Therefore, this NP is not constrained either. The \texttt{NOS\_TOPFRAC\_LH} only affects the $\tlhad$ channel, so the variation in hadronic is null. It causes up to $10\%$ bin-by-bin variations in both the signal and the background regions, which explains why it has a high ranking and is constrained at the same time.
%Figure \ref{fig:NPvar_other} shows the systematic variations due to a few constrained NPs, \texttt{JET\_JES\_PILEUP\_RHOTOPOLOGY}, \texttt{TAU\_TES\_INSITU} and \texttt{MET\_SOFTTRK\_RESOPERP}. They cause about $5-20\%$ bin-by-bin variations in the low BDT region, which can be constrained by the background region events. As a result, their impact on the signal is also reduced. Note that \texttt{MET\_SOFTTRK\_RESOPERP} is a one-sided NP, whose upward and downward variations are set to be the same.

Figure~\ref{fig:fcnc_correl_data} shows the correlation matrix for diffrent NPs. Except for self-correlations, and the correlations between FSR and Btag\_B\_0 with 46\%,
FSR with scale at 30\%, and Fakes from ABCD for electron and muon at -60\%, all other NPs have relatively small correlations with each other, which justifies the fit models for independent systematics. These high correlations are due to the fact that the FSR has significant impact on the low b-jet pT as well as the yields of selected
$t\bar t$ events; Similarly, the number of electron and muon fakes are constrains by the sum in the fit.   

\input{\FCNCFigures/tex/tthML_trexPrefit}
\input{\FCNCFigures/tex/xTFW_trexPrefit}

\begin{figure}[htb]
\centering
\includegraphics[width=0.45\textwidth]{\FCNCFigures/xTFW/Limit/tuH_NuisPar.pdf}
\includegraphics[width=0.45\textwidth]{\FCNCFigures/tthML/Limit/tuH_NuisPar.pdf}
\caption{ The pull distributions of asimov fit in hadronic channels (left) combined and leptonic channels combined (right) in terms of tuH merged signal . }
\label{fig:fcnc_pull_data}
\end{figure}


\begin{figure}[htb]
\centering
\includegraphics[width=0.4\textwidth]{\FCNCFigures/xTFW/Limit/tuH_Pruning_0.pdf}
\includegraphics[width=0.4\textwidth]{\FCNCFigures/xTFW/Limit/tuH_Pruning_1.pdf}
\caption{ Summary of the pruned nuisance parameters in the fit to the  Asimov dataset under the S+B hypothesis in hadronic channels part 1 in terms of tuH merged signal. }
\label{fig:xTFW_pruning_0}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[width=0.6\textwidth]{\FCNCFigures/xTFW/Limit/tuH_Pruning_2.pdf}
\caption{ Summary of the pruned nuisance parameters in the fit to the  Asimov dataset under the S+B hypothesis in hadronic channels part 2 in terms of tuH merged signal.}
\label{fig:xTFW_pruning_1}
\end{figure}


\begin{figure}[htb]
\centering
\includegraphics[width=0.99\textwidth]{\FCNCFigures/tthML/Limit/tuH_Pruning_0.pdf}
\caption{ Summary of the pruned nuisance parameters in the fit to the  Asimov dataset under the S+B hypothesis in leptonic channels part 1 in terms of tuH merged signal. }
\label{fig:tthML_pruning_0}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[width=0.99\textwidth]{\FCNCFigures/tthML/Limit/tuH_Pruning_1.pdf}
\caption{ Summary of the pruned nuisance parameters in the fit to the  Asimov dataset under the S+B hypothesis in leptonic channels part 2 in terms of tuH merged signal. }
\label{fig:tthML_pruning_1}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[width=0.99\textwidth]{\FCNCFigures/tthML/Limit/tuH_Pruning_2.pdf}
\caption{ Summary of the pruned nuisance parameters in the fit to the  Asimov dataset under the S+B hypothesis in leptonic channels part 3 in terms of tuH merged signal. }
\label{fig:tthML_pruning_2}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[width=0.45\textwidth]{\FCNCFigures/xTFW/Limit/tuH_Ranking.pdf}
\includegraphics[width=0.45\textwidth]{\FCNCFigures/tthML/Limit/tuH_Ranking.pdf}
\caption{ Ranking plot from a fit to a signal-plus-background Asimov dataset for (left) hadronic channels and (right)
leptonic channels in terms of tuH merged signal. The fitted values of the most important nuisance parameters and their impact on the measured
signal strength are shown. The black points, which are plotted according to the bottom horizontal scale, show the deviation
of each of the fitted nuisance parameters,$\hat{\theta}$, from $\theta_{0}$, which is the nominal value of that nuisance parameter, in units of the
pre-fit standard deviation $\Delta\theta$. The black error bars show the post-fit errors, $\sigma_{\theta}$ , which are close to 1 if these data do not
provide any further constraint on that uncertainty. Conversely, a value of $\sigma_{\theta}$ much smaller than 1 indicates a significant
reduction with respect to the original uncertainty. The nuisance parameters are sorted according to the post-fit effect of each on $\mu$ (hashed blue area),
with those with the largest impact at the top. Only the leading 30 nuisance parameters are shown. The post-fit effect on $\mu$,
shown according to the top horizontal scale, is calculated by fixing the corresponding nuisance parameter at $\hat{\theta}\pm \sigma_{\theta}$ and
redoing the fit. The difference between the default and modified $\mu$, $\Delta\mu$, represents the effect of the systematic uncertainty
in question on $\mu$.}
\label{fig:fcnc_rank_data}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[width=0.45\textwidth]{\FCNCFigures/xTFW/Limit/tuH_Ranking.pdf}
\includegraphics[width=0.45\textwidth]{\FCNCFigures/tthML/Limit/tuH_Ranking.pdf}
\caption{ Ranking plot from a fit to a signal-plus-background Asimov dataset for (left) hadronic channels and (right)
leptonic channels in terms of tcH merged signal. The fitted values of the most important nuisance parameters and their impact on the measured
signal strength are shown. The black points, which are plotted according to the bottom horizontal scale, show the deviation
of each of the fitted nuisance parameters,$\hat{\theta}$, from $\theta_{0}$, which is the nominal value of that nuisance parameter, in units of the
pre-fit standard deviation $\Delta\theta$. The black error bars show the post-fit errors, $\sigma_{\theta}$ , which are close to 1 if these data do not
provide any further constraint on that uncertainty. Conversely, a value of $\sigma_{\theta}$ much smaller than 1 indicates a significant
reduction with respect to the original uncertainty. The nuisance parameters are sorted according to the post-fit effect of each on $\mu$ (hashed blue area),
with those with the largest impact at the top. Only the leading 30 nuisance parameters are shown. The post-fit effect on $\mu$,
shown according to the top horizontal scale, is calculated by fixing the corresponding nuisance parameter at $\hat{\theta}\pm \sigma_{\theta}$ and
redoing the fit. The difference between the default and modified $\mu$, $\Delta\mu$, represents the effect of the systematic uncertainty
in question on $\mu$.}
\label{fig:fcnc_rank_data_tcH}
\end{figure}


\begin{figure}[htb]
\centering
\includegraphics[width=0.45\textwidth]{\FCNCFigures/xTFW/Limit/tuH_CorrMatrix.pdf}
\includegraphics[width=0.45\textwidth]{\FCNCFigures/tthML/Limit/tuH_CorrMatrix.pdf}
\caption{ Correlation matrix corresponding to the fit to the Asimov dataset under the signal-plus-background hypothesis. Only nuisance parameters with a correlation coefficient of at least 20\% with any other parameter are displayed for hadronic channels (left) combined and lepton channels combined (right).}
\label{fig:fcnc_correl_data}
\end{figure}














